{% load to_json %}
<script>
    let categories = JSON.parse(`{{categories_s|escapejs}}`)
    let products = JSON.parse(`{{products_s|escapejs}}`)
    let market_index_app = new Vue({
        el: "#market-index-app",
        data: {
            category: {},
            categories: categories,
            products: products,
            search_for: '',
            waiting: false,
        },
        methods: {
            filter: function () {
                this.accounts = accounts.filter(account => account.title.indexOf(this.search_for) > -1)

            },
            to_price: function (vall) {
                let color = 'primary'
                if (vall < 0)
                    color = 'danger'
                if (vall > 0)
                    color = 'success'
                vall = to_price(vall, "{{CURRENCY}}")
                return `
                    <span class="text-${color}">${vall}</span>
                    `
            },
            select_category: function (category_id) {
                market_index_app.waiting = true

                let url = "{% url 'market:api_category' category_id=1234 %}"
                url = url.replace('1234', category_id)

                $.get(url).done((data) => {
                    market_index_app.waiting = false
                    console.log(data)
                    market_index_app.category = data.category
                    market_index_app.categories = data.categories
                    market_index_app.products = data.products
                })
            },

        }
    })

</script>