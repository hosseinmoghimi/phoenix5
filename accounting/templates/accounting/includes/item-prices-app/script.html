<script>
    let item_prices_app = new Vue({
        el: "#item-prices-app",
        data: {
            product_or_service_id: page_id,
            buy_price: 0,
            sell_price: 0,
            account_id: 0,
            unit_name:"عدد",
            prices: JSON.parse("{{prices_s|escapejs}}"),
            message: {
                show: false,
                text: "",
                color: "",
            }
        },
        methods: {
            to_price: function (vall) {
                return to_price(vall, "{{CURRENCY}}")
            },
            add_price: function () {
                let url = "{% url 'accounting:add_price' %}"
                let payload = {
                    csrfmiddlewaretoken: csrfmiddlewaretoken,
                    product_or_service_id: this.product_or_service_id,
                    account_id: this.account_id,
                    buy_price: this.buy_price,
                    sell_price: this.sell_price,
                    unit_name: this.unit_name,

                }
                // console.log(payload)
                $.post(url, payload).done((data) => {
                    // console.log(data)
                    if (data.result === 'SUCCEED') {
                        
                        item_prices_app.prices.reverse()
                        item_prices_app.prices.push(data.price)
                        item_prices_app.prices.reverse()

                        item_prices_app.message = {
                            color: 'success',
                            show: true,
                            text: `با موفقیت اضافه شد.`
                        }
                    } else {
                        item_prices_app.message = {
                            color: 'danger',
                            show: true,
                            text: `<ul>
                                <li>قیمت های خرید و فروش صفر نباشد </li>
                                <li>حساب مورد نظر را انتخاب کنید.</li>
                                </ul>`
                        }
                    }
                    setTimeout(() => {
                        item_prices_app.message = {
                            show: false
                        }
                    }, 2000);

                })
            },
        }
    })
</script>